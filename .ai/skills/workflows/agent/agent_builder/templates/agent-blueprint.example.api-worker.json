{
  "kind": "agent_blueprint",
  "version": 1,
  "meta": {
    "generated_at": "2025-12-29T10:07:03.008804+00:00",
    "generated_by": "agent_builder",
    "source": "templates/example"
  },
  "agent": {
    "id": "example_agent_api_worker",
    "name": "Example Agent",
    "summary": "An example agent blueprint demonstrating schema structure.",
    "owners": [
      {
        "type": "team",
        "id": "example-team",
        "contact": "#example-team"
      }
    ]
  },
  "scope": {
    "in_scope": [
      "Accept a RunRequest and produce a structured RunResponse.",
      "Expose a stable API contract and basic operational hooks."
    ],
    "out_of_scope": [
      "Persisting secrets or credentials to the repo.",
      "Performing irreversible side effects without explicit approval points."
    ],
    "definition_of_done": "Agent can be invoked via the selected interfaces, passes acceptance scenarios, and is registered in the agent registry with required docs."
  },
  "integration": {
    "primary": "api",
    "attach": [
      "worker"
    ],
    "trigger": {
      "kind": "sync_request",
      "notes": "Primary entrypoint is a synchronous API call."
    },
    "target": {
      "kind": "service",
      "name": "example-backend-service",
      "path": "src/backend",
      "owner_hint": "example-team"
    },
    "upstream_contract_ref": "#/schemas/RunRequest",
    "downstream_contract_ref": "#/schemas/RunResponse",
    "failure_contract": {
      "mode": "propagate_error",
      "notes": "Fail fast with a structured error response; no suppression."
    },
    "rollback_or_disable": {
      "method": "feature_flag",
      "key": "FEATURE_EXAMPLE_AGENT_ENABLED",
      "notes": "Disable via feature flag for rollback."
    }
  },
  "interfaces": [
    {
      "type": "http",
      "entrypoint": "POST /agent/example_agent_api_worker/run",
      "input_schema_ref": "#/schemas/RunRequest",
      "output_schema_ref": "#/schemas/RunResponse",
      "error_schema_ref": "#/schemas/AgentError",
      "examples_min": 1
    },
    {
      "type": "worker",
      "entrypoint": "node src/adapters/worker/worker.js",
      "input_schema_ref": "#/schemas/RunRequest",
      "output_schema_ref": "#/schemas/RunResponse",
      "error_schema_ref": "#/schemas/AgentError",
      "examples_min": 1
    }
  ],
  "schemas": {
    "RunRequest": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "input"
      ],
      "properties": {
        "input": {
          "type": "object",
          "additionalProperties": true,
          "description": "Agent input payload."
        },
        "context": {
          "type": "object",
          "additionalProperties": true
        },
        "request_id": {
          "type": "string"
        }
      }
    },
    "RunResponse": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "output"
      ],
      "properties": {
        "output": {
          "type": "object",
          "additionalProperties": true
        },
        "trace": {
          "type": "object",
          "additionalProperties": true
        }
      }
    },
    "AgentError": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "code",
        "message"
      ],
      "properties": {
        "code": {
          "type": "string"
        },
        "message": {
          "type": "string"
        },
        "details": {
          "type": "object",
          "additionalProperties": true
        }
      }
    }
  },
  "model": {
    "primary": {
      "provider": {
        "type": "openai_compatible",
        "base_url_env_var": "LLM_BASE_URL",
        "api_key_env_var": "LLM_API_KEY",
        "notes": "OpenAI-compatible provider via gateway or local proxy."
      },
      "model": "gpt-4.1",
      "reasoning_profile": "fast",
      "timeout_ms": 30000
    },
    "fallback": null
  },
  "configuration": {
    "env_vars": [
      {
        "name": "LLM_BASE_URL",
        "description": "Base URL for an OpenAI-compatible API (e.g. https://api.openai.com/v1 or an internal gateway).",
        "required": true,
        "sensitivity": "internal",
        "example_placeholder": "https://api.openai.com/v1"
      },
      {
        "name": "LLM_API_KEY",
        "description": "API key for the LLM provider.",
        "required": true,
        "sensitivity": "secret",
        "example_placeholder": "<set-in-env>"
      },
      {
        "name": "LLM_MODEL",
        "description": "Model name to use for the primary path.",
        "required": true,
        "sensitivity": "internal",
        "example_placeholder": "gpt-4.1"
      },
      {
        "name": "AGENT_ENABLED",
        "description": "Master kill switch for the agent.",
        "required": true,
        "sensitivity": "internal",
        "example_placeholder": "true"
      },
      {
        "name": "AGENT_LOG_LEVEL",
        "description": "Logging level (debug|info|warn|error).",
        "required": false,
        "sensitivity": "internal",
        "example_placeholder": "info"
      },
      {
        "name": "AGENT_PORT",
        "description": "HTTP listen port for the API adapter.",
        "required": false,
        "sensitivity": "internal",
        "example_placeholder": "8080"
      }
    ],
    "config_files": [
      {
        "path": "config/default.json",
        "purpose": "Non-secret runtime configuration for adapters and core defaults."
      }
    ]
  },
  "acceptance": {
    "scenarios": [
      {
        "title": "API run returns a structured response",
        "given": "AGENT_ENABLED=true and LLM provider credentials are configured",
        "when": "POST /run with a valid RunRequest payload",
        "then": "Response is HTTP 200 and matches RunResponse schema",
        "expected_output_checks": [
          "JSON parses successfully",
          "Contains top-level `output` object"
        ],
        "priority": "P0"
      },
      {
        "title": "Health endpoint reports readiness",
        "given": "Service is started",
        "when": "GET /health",
        "then": "HTTP 200 with status payload",
        "expected_output_checks": [
          "Contains `status: ok`"
        ],
        "priority": "P0"
      },
      {
        "title": "Kill switch disables run",
        "given": "AGENT_ENABLED=false",
        "when": "POST /run",
        "then": "HTTP 503 with a structured AgentError",
        "expected_output_checks": [
          "HTTP status is 503",
          "Body contains error code and message"
        ],
        "priority": "P1"
      }
    ]
  },
  "deliverables": {
    "agent_module_path": "agents/example_agent_api_worker",
    "docs_path": "docs/agents/example_agent_api_worker",
    "registry_path": "docs/agents/registry.json",
    "core_adapter_separation": "required",
    "non_goals": [
      "Auto-modifying existing production service routing without user review."
    ]
  },
  "api": {
    "protocol": "http",
    "base_path": "/agent/example_agent_api_worker",
    "timeout_budget_ms": 15000,
    "routes": [
      {
        "name": "run",
        "method": "post",
        "path": "/run",
        "request_schema_ref": "#/schemas/RunRequest",
        "response_schema_ref": "#/schemas/RunResponse",
        "error_schema_ref": "#/schemas/AgentError"
      },
      {
        "name": "health",
        "method": "get",
        "path": "/health",
        "request_schema_ref": "#/schemas/RunRequest",
        "response_schema_ref": "#/schemas/RunResponse",
        "error_schema_ref": "#/schemas/AgentError"
      }
    ],
    "auth": {
      "kind": "api_key",
      "env_var": "AGENT_API_KEY",
      "notes": "Example only; adapt to your production auth model."
    },
    "degradation": {
      "mode": "route_to_worker",
      "notes": "If synchronous path times out, route request to worker and return an acknowledgement."
    }
  },
  "worker": {
    "source": {
      "kind": "queue",
      "name": "example-agent-queue",
      "notes": "Replace with your actual queue/topic/task source."
    },
    "execution": {
      "max_concurrency": 4,
      "timeout_ms": 60000
    },
    "retry": {
      "max_attempts": 3,
      "backoff": {
        "strategy": "exponential_jitter",
        "base_delay_ms": 500
      }
    },
    "idempotency": {
      "strategy": "payload_field",
      "key_ref": "task_id",
      "notes": "Derive idempotency key from payload field."
    },
    "failure": {
      "dead_letter": {
        "kind": "queue",
        "name": "example-agent-dlq"
      },
      "alert_on": "after_retries"
    }
  }
}
